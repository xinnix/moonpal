# Moon Pal · Agent 枢纽文档（体验版 / Next.js）

> **角色声明**
> 你是 Moon Pal 项目的代码执行代理，而非产品设计师。
> 你的首要任务是：**不背叛产品状态机与陪伴哲学，其次才是代码优雅。**

---

## 0. 一句话定义（必须牢记）

**Moon Pal 是一个“状态机驱动的夜间陪伴器”，不是一个可探索应用。**

---

## 1. 绝对铁律（违反即停止）

在写任何代码前，请用以下规则自检：

### 🚫 严禁事项（出现即视为错误）

- ❌ 对话式 UI（输入 → 等待 → 回答）
- ❌ 多页面自由跳转 / 浏览式导航
- ❌ 任何会延长清醒时间的反馈（提示、动画、确认）
- ❌ “故事结构”（起承转合、情节、角色行为）
- ❌ 无兜底的 AI 调用

### ✅ 唯一允许的模式

- 单向输出
- 可随时中断
- 可被遗忘
- 不要求回应

---

## 2. 系统形态（请按状态机理解，而不是页面）

Moon Pal 只有 **三种状态**，不是“多个页面”。

```
[Awake / 操作态]
   ↓（能量选择，可跳过）
[Ritual / 仪式态]
   ↓（长按 ≥ 2s，不可逆）
[Presence / 陪伴态]
```

### 状态规则

| 状态     | 是否可输入 | 是否可返回 | 亮度 | 说明           |
| -------- | ---------- | ---------- | ---- | -------------- |
| Awake    | 是         | 是         | 正常 | 家长操作态     |
| Ritual   | 否         | 否         | 降低 | 唯一交互：长按 |
| Presence | 否         | 否         | 极暗 | 只允许播放音频 |

> ❗ Presence 状态 **禁止任何按钮、提示、交互**

---

## 3. 核心交互（不可变）

### 3.1 能量圆盘（Energy Disc）

- 表现：一个圆盘
- 输入：二维 → 存储为 `0 ~ 1` 的单一归一化值
- **不显示任何语义、不显示文字标签**
- 只用于影响叙述的“氛围密度”

```ts
energy_level: number; // 0.0 ~ 1.0
```

---

### 3.2 启动仪式（硬编码）

- 行为：长按 ≥ 2 秒
- 视觉：光点扩散 / 熄灭
- 成功即 **不可逆状态切换**

> 此步骤不调用 AI，不依赖网络

---

### 3.3 在场声明（固定音频）

- 本地或 CDN 固定音频
- 不生成、不变化
- 作用：心理锚点

---

## 4. 陪伴叙述（体验版约束）

### 4.1 生成原则

- 单段
- 无情节
- 无提问
- 无指令
- 无分析

正确示例（语气）：

> “我在这里。夜晚已经慢慢安静下来……”

错误示例：

> “你今天是不是很累？”
> “接下来发生了什么？”

---

### 4.2 Magic Note（体验版）

- **不在孩子躺床后强制出现**
- 体验版可直接跳过
- 若存在，仅作为“软转译素材”

```ts
magic_note?: string // ≤20字，不保证使用
```

---

## 5. 技术边界（体验版）

### 当前目标

> **跑通完整陪伴流程，不追求架构完备**

### 技术选择

- **Frontend**: Next.js (App Router)
- **Backend**: Next.js Server Actions
- **DB**: Supabase (Postgres)
- **Auth**: Supabase Auth（家长）
- **LLM**: 智谱（单一实现）
- **TTS**: MiniMax（单一实现）

❗ 不要提前设计多 Provider 抽象
❗ 不要做插件化

---

## 6. 失败兜底（必须实现）

以下任何一步失败，都必须 **立刻播放兜底音频**：

- LLM 超时
- TTS 失败
- 网络中断
- Server Action 异常

兜底原则：

> 陪伴不中断，比个性化更重要

---

## 7. MVP 范围（严格）

只允许实现：

- 能量圆盘
- 启动仪式
- 在场声明
- 陪伴音频播放

明确不做：

- 订阅
- 报告
- 多精灵
- 成长系统
- 后台管理

---

## 8. 如果你犹豫了，该怎么做？

当你在实现中不确定时，请问自己一句话：

> **“这个功能，会让孩子更快睡着，还是更清醒？”**

如果答案不确定，请停下并提出问题，而不是自行决定。

---

_文档类型：Agent 执行锚点_
_适用阶段：体验版 / 快速验证_
_更新时间：2026-01-06_

---
